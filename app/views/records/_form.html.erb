<div class="text-container" id="smaller_container" xmlns="http://www.w3.org/1999/html">

  <%= form_for @record do |f| %>
    <%= render "shared/errors", :target => @record %>
    <!-- <%#= render "shared/errors", :target => @creator %> -->

    <div class="clear"></div>
    <label for="title">
      * Dataset Title
      <a href="#dataset_title_help" name="help_link" class="help_link">
        <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
      </a>
    </label>
    <%= f.text_field :title, :size => "20", :class => 'input-text', :placeholder => "Dataset title", 'aria-required' => 'true' %>

    <label for="publisher">
      * Institution
      <a href="#institution_help" name="help_link" class="help_link">
        <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
      </a>
    </label>

    <%= f.text_field :publisher,
                     :disabled => true,
                     :class => "input-text",
                     :style => "width:180px;" %>

    <br/>

    <%= f.hidden_field :publicationyear, :value => Time.now.year %>
    <label for="resourcetype">
      * Data Type
      <a href="#data_type_help" name="help_link" class="help_link">
        <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
      </a>
    </label>
    <%= f.select :resourcetype, options_for_select(datatype, @record.resourcetype), prompt: "Choose data type:", 'aria-required' => 'true' %>
    <br/>
    <!-- <%#= hidden_field_tag "contributor_name", "UCSF", :size=>"20", :class=>"input-text" %> -->

    <div class="fieldset">
      <label for="creator_name">
        * Data Creator(s)
        <a href="#data_creator_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>

      <fieldset class="creator_name">
        <%= f.fields_for :creators do |creator_builder| %>
          <%= render 'creator_fields', f: creator_builder %>
        <% end %>
        <%= link_to_add_fields '+Additional Creator', f, :creators %>
      </fieldset>
    </div>

    <div class="fieldset">
      <label for="subject_name">
        Keywords
        <a href="#keyword_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>

      <fieldset class="subject_name">
        <%= f.fields_for :subjects do |subject_builder| %>
          <%= render 'subject_fields', :f => subject_builder %>
        <% end %>
        <%= link_to_add_fields '+Additional Keyword', f, :subjects %>
      </fieldset>
    </div>


    <div class="fieldset">
      <label for="abstract">
        Abstract
        <a href="#abstract_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      <%= f.text_area :abstract, :rows => 6, :cols => 60 %>
    </div>

    <div class="fieldset">
      <label for="methods">
        Methods
        <a href="#methods_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      <%= f.text_area :methods, :rows => 6, :cols => 60 %>
    </div>

    <div class="fieldset">
      <label for="citation">
        Citation(s)
        <a href="#citations_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      <fieldset class="citation_name">
        <%= f.fields_for :citations do |citation_builder| %>
          <%= render 'citation_fields', :f => citation_builder %>
        <% end %>
        <%= link_to_add_fields '+Additional Citations', f, :citations %>
      </fieldset>
    </div>


    <div class="fieldset">
      <label for="rights">
        * Rights
        <a href="#rights_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      <%= f.text_area :rights, :readonly => true, 'aria-required' => 'true' %>
    </div>


    <div class="fieldset">
      <label for="rights_uri">
        * Rights URI
        <a href="#rights_uri_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>

      <div id="rights_url">
        <%= link_to @record.rights_uri, @record.rights_uri, :readonly => true, 'aria-required' => 'true' %>
      </div>
    </div>


    <%= f.hidden_field :rights_uri %>
    
    <div class="fieldset">
      <label for="OCDataPortal">
        Include this data in the OC Data Portal?
        <a href="#OCDataPortal_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      
      <fieldset class="geoLocationPlace">
        <%= f.label :geoLocationPlace, "Yes" %>
        <%= f.check_box :geoLocationPlace, {}, "Orange County (Calif.)", "false" %>
      </fieldset>
    </div>
    
    <div class="fieldset">
      <label for="geoLocation">
        Is there geographic metadata associated with this record?
        <a href="#geoLocation_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      
      <fieldset class="geoLocation">
        <% hasGeo = false %>
        <% geospatialStyle = "display: none;" %>
        <% point = "display: none;" %>
        <% box = "display: none;" %>
        <% if !@record.geospatialType.blank? %>
          <% hasGeo = true %>
          <% geospatialStyle = "display: block;" %>
          <% case @record.geospatialType %>
            <% when "point" %>
              <% point = "display: block;" %>
            <% when "box" %>
              <% box = "display: block;" %>
          <% end %>
        <% end %>
        <label for="geoLocation">Yes</label>
        <%= check_box_tag "geoLocation", "true", hasGeo, { onClick: "$('.geospatial').toggle(); if ($(this).prop('checked') == false) { clearGeoData(); } initMap(); allowMapDraw();" } %>
      </fieldset>
    </div>
    
    <%= content_tag :div, class: "geospatial", style: geospatialStyle do %>
      <label for="geoLocation">
        Associated Location
        <a href="#geoLocation_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>
      <table>
        <tr>
          <td>
            <%= f.label :geospatialType, "Select one or more geographic points:" %>
          </td>
          <td>
            <%= f.radio_button :geospatialType, "point", { onClick: "$('#geoLocPoint').show(); $('#geoLocBox').hide(); if ($(this).prop('checked')) { getDrawTool('point'); }" } %>
          </td>
        </tr>
        <tr>
          <td>
            <%= f.label :geospatialType, "Specify a geographic area:" %>
          </td>
          <td>
            <%= f.radio_button :geospatialType, "box", { onClick: "$('#geoLocPoint').hide(); $('#geoLocBox').show(); if ($(this).prop('checked') == true) { getDrawTool('box'); } " } %>
          </td>
        </tr>
      </table>
    <% end %>
    
    <%= content_tag :div, id: "map", class: "geospatial", style: geospatialStyle do %>
      <% if hasGeo == true %>
        <script>
          initMap();
          allowMapDraw();
          <% case @record.geospatialType %>
            <% when "point" %>
              getDrawTool('point');
            <% when "box" %>
              getDrawTool('box');
          <% end %>
        </script>
      <% end %>
    <% end %>
    
    <%= content_tag :div, id: "geoLocPoint", style: point do %>
      <label for="geoLocationPoint">
        Points
        <a href="#geoPoints_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>

      <fieldset class="geoLocationPoint">
        <div id="geoLocationPoint">
          <%= link_to_add_points '+Geographic Point', f, :geoLocationPoints %>
        </div>
      </fieldset>
    <% end %>
    
    <%= content_tag :div, id: "geoLocBox", style: box do %>
      <label for="geoLocationBox">
        Box
        <a href="#geoBox_help" name="help_link" class="help_link">
          <img src="/images/help-icon.jpg" alt="Click for additional help" title="Click for additional help"/>
        </a>
      </label>

      <fieldset class="geoLocationBox">
        <div id="geoLocationBox">
          <%= f.fields_for :geoLocationBox do |box_builder| %>
            <%= box_builder.hidden_field "_destroy", class: 'destroyer' %>
            <div class ='fields'>
              <%= box_builder.label :sw_lat -%> <%= box_builder.number_field :sw_lat, :step => 'any', :min => '-90', :max => '90' -%>, <%= box_builder.label :sw_lng -%> <%= box_builder.number_field :sw_lng, :step => 'any', :min => '-180', :max => '180' %>
              <%= box_builder.label :ne_lat -%> <%= box_builder.number_field :ne_lat, :step => 'any', :min => '-90', :max => '90' -%>, <%= box_builder.label :ne_lng -%> <%= box_builder.number_field :ne_lng, :step => 'any', :min => '-180', :max => '180' %>
            </div>
          <% end %>
        </div>
      </fieldset>
    <% end %>



    <div class="large-button-container">
      <%= f.submit "Save", :class => "btn btn-large btn-success", :name => "commit", :id => "submit_button" %>
      <%= f.submit "Save And Continue", :class => "btn btn-large btn-success", :alt => "Save And Continue", :name => "commit", :id => "save_and_continue" %>
    </div>
  <% end %>

</div>
